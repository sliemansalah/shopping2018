<!-- begin:: Page -->
<div class="m-grid m-grid--hor m-grid--root m-page">
  <!-- BEGIN: Header -->
  <app-header></app-header>
  <!-- END: Header -->
  <!-- begin::Body -->
  <div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">
    <!-- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Start Side Mneu ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ -->
    <app-side-nav [ordersActiveId]="pageId"></app-side-nav>
    <!-- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ End Side Mneu ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ -->
    <!-- ########### START PAGE CONTENT ########### -->
    <div class="m-grid__item m-grid__item--fluid m-wrapper">
      <!-- BEGIN: Subheader -->
      <div class="m-subheader ">
        <div class="d-flex align-items-center">
          <div class="mr-auto"><h3 class="m-subheader__title ">جميع الطلبات</h3></div>
        </div>
      </div>
      <!-- END: Subheader -->
      <div class="m-content">
        <div class="row">
          <div class="col-xl-12 col-lg-12">
            <div class="m-section m-portlet m-portlet--full-height get-float-right">
              <div class="m-section__content col-xl-12 col-lg-12">
                <div class="m-portlet m-portlet--tab">
                  <!-- Start Table -->
                  <div class="m-portlet__body">
                    <!-- begin: Search Form -->
                    <div class="m-form m-form--label-align-right m--margin-top-20 m--margin-bottom-30">
                      <div class="row align-items-center">
                        <div class="col-xl-12 order-2 order-xl-1">
                          <div class="form-group m-form__group row align-items-center">
                            <div class="status_select">
                              <div class="m-form__group m-form__group--inline">
                                <div class="m-form__label"><label> الحالة: </label></div>
                                <!-- Select -->
                                <div class="m-input-icon m-input-icon--left m-input-icon--right">
                                  <select id="select_service" name="service_id" class="form-control m-input m-input--square status_inner" id="exampleSelect1" (change)="statusChanged($event)">
                                    <option value="" disabled selected>اختر الحالة</option>
                                    <option value="0">All</option>
                                    <option *ngFor="let status of statusArray" [value]="[status.id]">{{ status.name }}</option>
                                  </select>
                                  <span class="m-input-icon__icon m-input-icon__icon--right">
                                    <span> <i class="la la-cogs"></i> </span>
                                  </span>
                                </div>
                                <!-- Select -->
                              </div>
                              <div class="d-md-none m--margin-bottom-10"></div>
                            </div>
                            <div>
                              <div class="m-form__group m-form__group--inline">
                                <div class="m-form__label"><label class="m-label m-label--single"> التاريخ: </label></div>
                                <div class="m-input-icon m-input-icon--left m-input-icon--right">
                                  <input class="form-control m-input m-input--square status_inner" type="date" (change)="dateChanged($event)" value="" id="example-date-input" name="order_date" />
                                  <span class="m-input-icon__icon m-input-icon__icon--right">
                                    <span> <i class="la la-cogs"></i> </span>
                                  </span>
                                </div>
                              </div>
                              <div class="d-md-none m--margin-bottom-10"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- end: Search Form -->
                    <!-- begin: Datatable -->
                    <!-- *ngIf="!anyTechnicalExist" -->
                    <!-- <div>لا توجد بيانات للعرض</div> -->
                    <!-- *ngIf="anyTechnicalExist" -->
                    <div class="m-datatable m-datatable--default m-datatable--brand m-datatable--loaded" id="all-search-table">
                      <!-- *ngIf="emptyArray" -->
                      <!-- <div class="m-loader m-loader--brand" style="width: 30px; display: inline-block;"></div> -->
                      <table class="m-datatable__table search-table" id="html_table" width="100%">
                        <thead class="m-datatable__head table-head">
                          <tr class="m-datatable__row">
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>المسلسل</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>كل البيانات</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>حالة الطلب</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>إسم العميل</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>تاريخ الطلب</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>تاريخ التسجيل</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>توقيت بداية الطلب</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>توقيت إنتهاء الطلب</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>الخدمة</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>الفاتورة</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>تعديل الطلب</span></th>
                            <th class="m-datatable__cell m-datatable__cell--sort"><span>حذف الطلب</span></th>
                          </tr>
                        </thead>
                        <tbody class="m-datatable__body" *ngFor="let order of orders">
                          <tr class="m-datatable__row">
                            <td class="m-datatable__cell">
                              <span>{{ order.id }}</span>
                            </td>
                            <td class="m-datatable__cell openSubService">
                              <span (click)="toggleSubMenuIn(order.id)"><i (click)="rotatePlus(order.id)" id="plus{{ order.id }}" class="la la-plus plusSlide"></i></span>
                            </td>
                            <td class="m-datatable__cell">
                              <span class="order-status-{{ order.status.id }} status_span">{{ order.status.name }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.client.name }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.order_date }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.creation_date }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.start }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.end }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>{{ order.service.name }}</span>
                            </td>
                            <td class="m-datatable__cell">
                              <span> <button type="button" class="btn btn-info">إعرض الفاتورة</button> </span>
                            </td>
                            <td class="m-datatable__cell">
                              <span>
                                <!--   -->
                                <button (click)="updateOrder(order)" type="button" class="btn btn-success update-button" *ngIf="order.status.name !== 'finished' && order.status.name !== 'started'">
                                  تعديل البيانات
                                </button></span
                              >
                            </td>
                            <td class="m-datatable__cell">
                              <span>
                                <!--  -->
                                <button (click)="deleteOrder(order.id)" type="button" class="btn btn-danger" *ngIf="order.status.name !== 'finished' && order.status.name !== 'started'">
                                  حذف الطلب
                                </button></span
                              >
                            </td>
                          </tr>
                          <!-- Sub Service Row -->
                          <div class="SubServiceContainer" id="{{ order.id }}" (click)="toggleSubMenuOut(order.id)">
                            <div class="popup-back">
                              <h3>كل التفاصيل</h3>
                              <div>المسلسل : {{ order.id }}</div>
                              <div>إسم العميل : {{ order.client.name }}</div>
                              <div>إسم المصدر : {{ order.source.name }}</div>
                              <div>إسم الخدمة : {{ order.service.name }}</div>
                              <div>إسم الفني : {{ order.technician.name }}</div>
                              <div *ngIf="order.offer !== null">إسم العرض : {{ order.offer.name }}</div>
                              <div *ngIf="order.offer !== null">تفاصيل العرض : {{ order.offer.description }}</div>
                              <div>تاريخ الطلب : {{ order.order_date }}</div>
                              <div>تاريخ التسجيل : {{ order.creation_date }}</div>
                              <div>توقيت بداية الطلب : {{ order.start }}</div>
                              <div>توقيت نهاية الطلب : {{ order.end }}</div>
                              <div *ngIf="order.details">تفاصيل الطلب : {{ order.details }}</div>
                              <div>
                                حالة الطلب : <span *ngIf="order.status.name === 'finished'" class="{{ order.status.name }} status_span">إنتهاء الطلب</span>
                                <span *ngIf="order.status.name === 'started'" class="{{ order.status.name }} status_span">بداية الطلب</span>
                                <span *ngIf="order.status.name === 'admin_approved'" class="{{ order.status.name }} status_span">وافق الأدمن</span>
                                <span *ngIf="order.status.name === 'technician_approved'" class="{{ order.status.name }} status_span">وافق الفني</span>
                                <span *ngIf="order.status.name === 'admin_pending'" class="{{ order.status.name }} status_span">بإنتظار الموافقة</span>
                                <span *ngIf="order.status.name === 'postponed'" class="{{ order.status.name }} status_span">تم التأجيل</span>
                              </div>
                            </div>
                          </div>
                          <!-- Sub Service Row -->
                        </tbody>
                      </table>
                      <div class="m-datatable__pager m-datatable--paging-loaded clearfix">
                        <ul class="m-datatable__pager-nav">
                          <li *ngFor="let i of pagesNumber">
                            <a (click)="goPage(i)" [class]="pageId == i ? pageActiveNumberClass : pageNumberClass">{{ i }}</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <!-- end: Datatable -->
                  </div>
                  <!-- End Table -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="update-form" *ngIf="editMode">
        <div class="popup-form"><app-order-form [updatedData]="updatedData" [editMode]="editMode" (editModeChange)="editModeChange($event)" (editSuccess)="editSuccess($event)"></app-order-form></div>
      </div>
      <!-- begin::Footer -->
      <app-footer></app-footer>
      <!-- end::Footer -->
    </div>
    <!-- ########### END PAGE CONTENT ########### -->
  </div>
  <!-- end:: Body -->
</div>
<!-- end:: Page -->
